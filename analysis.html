<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task & Calendar Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
    }

    /* Custom Scrollbar for cleaner look */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: #e5e7eb;
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #d1d5db;
    }

    /* Donut Chart CSS */
    .donut-chart {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: conic-gradient(
              #fbbf24 0% 35%,   /* Orange - Study */
              #c084fc 35% 60%,  /* Purple - Other */
              #3b82f6 60% 100%  /* Blue - Work */
      );
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .donut-hole {
      width: 110px;
      height: 110px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    /* Calendar Grid Lines */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr); /* 5 Columns for Mon-Fri */
      /* Rows will be auto-generated */
    }

    .calendar-cell {
      min-height: 120px;
      border-bottom: 1px solid #f3f4f6;
      border-right: 1px solid #f3f4f6;
      padding: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: background-color 0.2s;
    }

    .calendar-cell:nth-child(5n) {
      border-right: none;
    }

    .calendar-cell:hover {
      background-color: #f9fafb;
    }

    .today-highlight {
      background-color: #fff;
      box-shadow: inset 0 0 0 2px #374151; /* Dark border for selected state */
    }

    /* Transition for sidebars */
    .sidebar-panel {
      transition: width 0.3s ease-in-out, opacity 0.3s ease-in-out;
      overflow-x: hidden;
    }
    .sidebar-hidden {
      width: 0 !important;
      opacity: 0;
      border: none;
      padding: 0;
    }

    /* Blur Overlay */
    #modal-overlay {
      backdrop-filter: blur(4px);
      background-color: rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen flex overflow-x-auto min-w-[1280px] relative">

<!-- MODAL OVERLAY (Initially Hidden) -->
<div id="modal-overlay" class="fixed inset-0 z-50 hidden flex items-center justify-center">
  <!-- Modal Card -->
  <div class="bg-[#F2F2F2] w-[500px] h-[350px] rounded-3xl shadow-xl p-8 flex flex-col relative">

    <div class="flex-1 flex flex-col justify-center">
      <label class="text-xs text-gray-500 font-medium mb-1 ml-1">Entry name</label>
      <input type="text" id="modal-task-title" placeholder="New Task"
             class="bg-transparent text-4xl font-normal text-gray-800 placeholder-gray-400 focus:outline-none w-full mb-8"
             oninput="updateDraftTask()">

      <div class="flex gap-4 mb-4">
        <div class="flex flex-col">
          <label class="text-xs text-gray-500 font-medium mb-1 ml-1">Date</label>
          <input type="date" id="modal-task-date"
                 class="bg-white/50 px-3 py-2 rounded-lg text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200"
                 onchange="updateDraftTask()">
        </div>
        <div class="flex flex-col">
          <label class="text-xs text-gray-500 font-medium mb-1 ml-1">Time</label>
          <input type="time" id="modal-task-time"
                 class="bg-white/50 px-3 py-2 rounded-lg text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200"
                 onchange="updateDraftTask()">
        </div>
      </div>
    </div>

    <!-- Modal Actions -->
    <div class="flex justify-end gap-3 mt-auto">
      <button onclick="cancelTaskModal()" class="px-6 py-2 rounded-full text-sm font-medium text-gray-600 hover:bg-black/5 transition-colors">Cancel</button>
      <button onclick="saveTaskModal()" class="px-6 py-2 rounded-full text-sm font-medium bg-black text-white hover:bg-gray-800 transition-colors shadow-lg">Save</button>
    </div>
  </div>
</div>

<!-- 1. LEFT SIDEBAR (Navigation) -->
<aside class="w-64 bg-white border-r border-gray-200 flex flex-col justify-between shrink-0 z-20 sticky left-0">
  <!-- Top Section -->
  <div>
    <!-- User Profile -->
    <div class="p-6 flex items-center gap-3 mb-6">
      <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
        <i data-lucide="user" class="w-6 h-6"></i>
      </div>
      <div>
        <h3 class="font-semibold text-sm text-gray-900">John Doe</h3>
        <p class="text-xs text-gray-400">Pro Member</p>
      </div>
      <button class="ml-auto text-gray-400 hover:text-gray-600">
        <i data-lucide="bell" class="w-5 h-5"></i>
      </button>
    </div>

    <!-- Navigation Links -->
    <nav class="px-4 space-y-1">
      <!-- Toggle to Calendar (Main View + Hide Panels maybe? For now just activates calendar view) -->
      <button onclick="switchView('calendar')" class="w-full flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg group">
        <i data-lucide="calendar" class="w-5 h-5 text-gray-400 group-hover:text-gray-900"></i>
        <span class="font-medium">Calendar</span>
      </button>

      <!-- Toggle Tasks Panel -->
      <button id="nav-tasks" onclick="switchView('tasks')" class="w-full flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg group">
        <i data-lucide="check-square" class="w-5 h-5 text-gray-400 group-hover:text-gray-900"></i>
        <span class="font-medium">Tasks</span>
      </button>

      <!-- Toggle Reports Panel -->
      <button id="nav-reports" onclick="switchView('reports')" class="w-full flex items-center gap-3 px-4 py-3 text-gray-900 bg-gray-100 rounded-lg group">
        <i data-lucide="bar-chart-2" class="w-5 h-5 text-gray-900"></i>
        <span class="font-medium">Reports</span>
      </button>
    </nav>
  </div>

  <!-- Bottom Section -->
  <div class="p-4 space-y-1">
    <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
      <i data-lucide="search" class="w-5 h-5 text-gray-400"></i>
      <span class="font-medium">Search</span>
    </a>
    <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
      <i data-lucide="settings" class="w-5 h-5 text-gray-400"></i>
      <span class="font-medium">Settings</span>
    </a>
    <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
      <i data-lucide="help-circle" class="w-5 h-5 text-gray-400"></i>
      <span class="font-medium">Help</span>
    </a>
  </div>
</aside>

<!-- 2a. REPORT SIDEBAR (Analysis Portion) -->
<aside id="reports-sidebar" class="sidebar-panel w-80 bg-white border-r border-gray-200 flex flex-col overflow-y-auto shrink-0">
  <!-- Header -->
  <div class="p-6 border-b border-gray-100 sticky top-0 bg-white z-10">
    <div onclick="closeSidebars()" class="flex items-center gap-2 text-gray-500 mb-4 cursor-pointer hover:text-gray-800 transition-colors w-max">
      <i data-lucide="arrow-left" class="w-4 h-4"></i>
      <span class="text-sm font-medium">Back</span>
    </div>
    <h2 id="report-date-header" class="text-xl font-bold text-gray-900 whitespace-nowrap">Sept 4, 2025</h2>
  </div>

  <!-- Time Report Section -->
  <div class="p-6 border-b border-gray-100 min-w-[320px]">
    <div class="flex items-center gap-2 mb-4 text-gray-700 font-semibold">
      <i data-lucide="clock" class="w-4 h-4"></i>
      <h3>Time Report</h3>
    </div>

    <div class="space-y-6">
      <!-- Total Hours -->
      <div>
        <div class="flex justify-between text-xs font-semibold text-gray-800 mb-1">
          <span>Total Hours</span>
        </div>
        <div class="h-10 bg-gray-200 rounded overflow-hidden relative">
          <div class="absolute inset-0 flex gap-1">
            <div class="w-1 bg-white opacity-50 h-full"></div>
            <div class="w-1 bg-white opacity-50 h-full"></div>
            <div class="w-1 bg-white opacity-50 h-full"></div>
          </div>
          <div class="h-full bg-gray-300 w-[85%] flex items-center justify-end px-2">
            <span class="text-xs font-bold text-gray-800 whitespace-nowrap">10 Hours 45 mins</span>
          </div>
        </div>
      </div>

      <!-- Productive Hours -->
      <div>
        <div class="flex justify-between text-xs font-semibold text-gray-800 mb-1">
          <span>Productive Hours</span>
        </div>
        <div class="h-10 bg-gray-200 rounded overflow-hidden">
          <div class="h-full bg-gray-300 w-[60%] flex items-center justify-end px-2">
            <span class="text-xs font-bold text-gray-800 whitespace-nowrap">6 Hours 00 mins</span>
          </div>
        </div>
      </div>

      <!-- Leisure Hours -->
      <div>
        <div class="flex justify-between text-xs font-semibold text-gray-800 mb-1">
          <span>Leisure Hours</span>
        </div>
        <div class="h-10 bg-gray-200 rounded overflow-hidden">
          <div class="h-full bg-gray-300 w-[45%] flex items-center justify-end px-2">
            <span class="text-xs font-bold text-gray-800 whitespace-nowrap">4 Hours 45 mins</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Category Report Section -->
  <div class="p-6 border-b border-gray-100 min-w-[320px]">
    <div class="flex items-center gap-2 mb-6 text-gray-700 font-semibold">
      <i data-lucide="pie-chart" class="w-4 h-4"></i>
      <h3>Category Report</h3>
    </div>

    <div class="flex flex-col items-center">
      <div class="donut-chart relative shadow-sm">
        <!-- Floating label -->
        <div class="absolute -top-2 -left-4 bg-gray-200 px-2 py-1 rounded shadow text-xs font-bold text-gray-700 z-10 whitespace-nowrap">
          Study: 5 hr
        </div>
        <div class="donut-hole">
          <div class="w-full h-full rounded-full border-4 border-white"></div>
        </div>
      </div>
    </div>
  </div>
</aside>

<!-- 2b. TASKS SIDEBAR -->
<aside id="tasks-sidebar" class="sidebar-panel sidebar-hidden w-80 bg-white border-r border-gray-200 flex flex-col overflow-y-auto shrink-0">
  <!-- Header -->
  <div class="p-6 border-b border-gray-100 sticky top-0 bg-white z-10">
    <div onclick="closeSidebars()" class="flex items-center gap-2 text-gray-500 mb-4 cursor-pointer hover:text-gray-800 transition-colors w-max">
      <i data-lucide="arrow-left" class="w-4 h-4"></i>
      <span class="text-sm font-medium">Back</span>
    </div>
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-bold text-gray-900 flex items-center gap-2">
        <i data-lucide="check-square" class="w-5 h-5"></i> Tasks
      </h2>
      <div class="flex gap-2">
        <button class="text-gray-400 hover:text-gray-600"><i data-lucide="more-horizontal" class="w-5 h-5"></i></button>
      </div>
    </div>
  </div>

  <!-- Task List Container -->
  <div class="flex-1 p-6 relative">
    <div id="task-list-container" class="space-y-3">
      <!-- Tasks will be injected here -->
    </div>

    <!-- Add Button (Triggers Modal now) -->
    <button id="add-task-btn" onclick="openTaskModal()" class="mt-6 flex items-center gap-2 text-gray-500 hover:text-gray-900 transition-colors w-full p-2 rounded hover:bg-gray-50">
      <i data-lucide="plus" class="w-4 h-4"></i>
      <span class="text-sm font-medium">New Task</span>
    </button>
  </div>
</aside>

<!-- 3. MAIN CONTENT (Calendar) -->
<main class="flex-1 flex flex-col h-full bg-white relative shrink-0">
  <!-- Header -->
  <header class="h-20 border-b border-gray-200 flex items-center justify-between px-8 shrink-0">
    <div class="flex items-center gap-4">
      <!-- Sidebar Toggle (Only visible if sidebars are closed) -->
      <button id="show-sidebar-btn" onclick="switchView('reports')" class="hidden p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-800 rounded-lg transition-colors" title="Show Reports">
        <i data-lucide="panel-left-open" class="w-6 h-6"></i>
      </button>

      <div class="flex items-baseline gap-2">
        <h1 id="calendar-title-month" class="text-3xl font-bold text-gray-900">Sept</h1>
        <span id="calendar-title-year" class="text-3xl font-light text-gray-500">2025</span>
      </div>
    </div>

    <div class="flex bg-gray-100 p-1 rounded-lg">
      <button class="px-4 py-1.5 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md">5-day</button>
      <button class="px-4 py-1.5 text-sm font-medium bg-white text-gray-900 shadow-sm rounded-md ring-1 ring-gray-200">Week</button>
      <button class="px-4 py-1.5 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md">Month</button>
    </div>
  </header>

  <!-- Calendar Container -->
  <div class="flex-1 overflow-y-auto">
    <!-- Days Header -->
    <div class="grid grid-cols-5 border-b border-gray-200 sticky top-0 bg-white z-10">
      <div class="py-3 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider">Mon</div>
      <div class="py-3 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider">Tue</div>
      <div class="py-3 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider">Wed</div>
      <div class="py-3 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider">Thur</div>
      <div class="py-3 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider">Fri</div>
    </div>

    <!-- The Grid -->
    <div id="calendar-grid" class="calendar-grid pb-10">
      <!-- Javascript will populate this -->
    </div>
  </div>
</main>

<script>
  // ---- DATA STATE ----
  // Initialize with the data from the mock
  const currentYear = new Date().getFullYear();
  const currentMonth = new Date().getMonth();

  let appData = {
    tasks: [
      { id: 1, title: "Task #2", date: new Date(currentYear, currentMonth, 4), color: "bg-blue-100 text-blue-600", completed: false },
      { id: 2, title: "Meeting", date: new Date(currentYear, currentMonth, 4), color: "bg-purple-100 text-purple-600", completed: false },
      { id: 3, title: "Task #3", date: new Date(currentYear, currentMonth, 5), color: "bg-orange-100 text-orange-600", completed: false },
      { id: 4, title: "Review", date: new Date(currentYear, currentMonth, 12), color: "bg-red-100 text-red-600", completed: false },
      { id: 5, title: "Quotes", date: new Date(currentYear, currentMonth, 17), color: "bg-blue-50 text-blue-400", completed: false },
      { id: 6, title: "Lab", date: new Date(currentYear, currentMonth, 22), color: "bg-green-100 text-green-600", completed: false },
      { id: 7, title: "Task #1", date: new Date(currentYear, currentMonth, 29), color: "bg-orange-100 text-orange-600", completed: false }
    ]
  };

  // Initialize Lucide Icons
  lucide.createIcons();

  // ---- VIEW CONTROLLER ----
  const reportsSidebar = document.getElementById('reports-sidebar');
  const tasksSidebar = document.getElementById('tasks-sidebar');
  const showSidebarBtn = document.getElementById('show-sidebar-btn');
  const navReports = document.getElementById('nav-reports');
  const navTasks = document.getElementById('nav-tasks');

  function switchView(viewName) {
    // Reset Nav Styles
    const activeClass = "bg-gray-100 text-gray-900";
    const inactiveClass = "text-gray-600 hover:bg-gray-50";

    // Helper to set class
    const setNavState = (el, active) => {
      if(active) {
        el.className = `w-full flex items-center gap-3 px-4 py-3 rounded-lg group ${activeClass}`;
        el.querySelector('i').className = "w-5 h-5 text-gray-900";
      } else {
        el.className = `w-full flex items-center gap-3 px-4 py-3 rounded-lg group ${inactiveClass}`;
        el.querySelector('i').className = "w-5 h-5 text-gray-400 group-hover:text-gray-900";
      }
    }

    if (viewName === 'reports') {
      reportsSidebar.classList.remove('sidebar-hidden');
      tasksSidebar.classList.add('sidebar-hidden');
      showSidebarBtn.classList.add('hidden');
      setNavState(navReports, true);
      setNavState(navTasks, false);
    } else if (viewName === 'tasks') {
      reportsSidebar.classList.add('sidebar-hidden');
      tasksSidebar.classList.remove('sidebar-hidden');
      showSidebarBtn.classList.add('hidden');
      setNavState(navReports, false);
      setNavState(navTasks, true);
      renderTaskList(); // Ensure list is fresh
    } else {
      // Calendar only / Close sidebars (Optional logic)
    }
  }

  function closeSidebars() {
    reportsSidebar.classList.add('sidebar-hidden');
    tasksSidebar.classList.add('sidebar-hidden');
    showSidebarBtn.classList.remove('hidden');
  }

  // ---- MODAL & REAL-TIME PREVIEW LOGIC ----

  let draftTaskId = null; // Track the ID of the task currently being edited/created

  function openTaskModal() {
    const overlay = document.getElementById('modal-overlay');
    const titleInput = document.getElementById('modal-task-title');
    const dateInput = document.getElementById('modal-task-date');

    // 1. Create a Draft Task ID
    draftTaskId = Date.now();

    // 2. Set Default Values (Today)
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const day = String(today.getDate()).padStart(2, '0');
    const todayStr = `${year}-${month}-${day}`;

    dateInput.value = todayStr;
    titleInput.value = '';

    // 3. Insert Draft Task into State (Empty title for now)
    appData.tasks.push({
      id: draftTaskId,
      title: "New Task", // Default placeholder for grid
      date: today,
      color: "bg-gray-800 text-white", // Distinguishable color for draft
      completed: false,
      isDraft: true // Flag to identify it
    });

    // 4. Show Modal
    overlay.classList.remove('hidden');
    titleInput.focus();

    // 5. Render to show the "New Task" immediately on the grid
    generateCalendar();
  }

  function updateDraftTask() {
    if (!draftTaskId) return;

    const titleInput = document.getElementById('modal-task-title');
    const dateInput = document.getElementById('modal-task-date');

    // Find the draft task
    const taskIndex = appData.tasks.findIndex(t => t.id === draftTaskId);
    if (taskIndex === -1) return;

    // Parse Date
    const dateVal = dateInput.value;
    let newDate = new Date();
    if (dateVal) {
      const dateParts = dateVal.split('-');
      newDate = new Date(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2]));
    }

    // Update State
    appData.tasks[taskIndex].title = titleInput.value || "New Task"; // Fallback text
    appData.tasks[taskIndex].date = newDate;

    // Re-render Calendar to show changes in REAL TIME
    generateCalendar();
  }

  function cancelTaskModal() {
    // Remove the draft task from state
    if (draftTaskId) {
      appData.tasks = appData.tasks.filter(t => t.id !== draftTaskId);
    }

    closeModal();
    generateCalendar(); // Re-render to remove the ghost task
    draftTaskId = null;
  }

  function saveTaskModal() {
    // Find draft and make it permanent (remove isDraft flag)
    const taskIndex = appData.tasks.findIndex(t => t.id === draftTaskId);
    if (taskIndex !== -1) {
      // If title is empty, maybe give default?
      if (!document.getElementById('modal-task-title').value) {
        appData.tasks[taskIndex].title = "Untitled Task";
      }
      delete appData.tasks[taskIndex].isDraft;
      // Change color to regular color
      appData.tasks[taskIndex].color = "bg-gray-200 text-gray-700";
    }

    closeModal();
    renderTaskList(); // Update the sidebar list
    generateCalendar();
    draftTaskId = null;
  }

  function closeModal() {
    document.getElementById('modal-overlay').classList.add('hidden');
  }


  // ---- TASK MANAGEMENT ----

  function renderTaskList() {
    const container = document.getElementById('task-list-container');
    container.innerHTML = '';

    // Filter out drafts from the list view (only show saved tasks in the list)
    const visibleTasks = appData.tasks.filter(t => !t.isDraft);

    visibleTasks.forEach(task => {
      const dateStr = task.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      const div = document.createElement('div');
      div.className = "flex items-center gap-3 p-2 hover:bg-gray-50 rounded group cursor-pointer";
      div.innerHTML = `
                    <div class="relative flex items-center">
                        <input type="checkbox" ${task.completed ? 'checked' : ''} class="peer w-4 h-4 border-gray-300 rounded text-blue-600 focus:ring-blue-500 cursor-pointer">
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-700 truncate ${task.completed ? 'line-through text-gray-400' : ''}">${task.title}</p>
                        <p class="text-xs text-gray-400">${dateStr}</p>
                    </div>
                    <div class="opacity-0 group-hover:opacity-100 flex gap-1">
                        <button class="text-gray-400 hover:text-blue-600 p-1"><i data-lucide="edit-2" class="w-3 h-3"></i></button>
                    </div>
                `;
      container.appendChild(div);
    });
    lucide.createIcons();
  }


  // ---- CALENDAR LOGIC ----

  const calendarGrid = document.getElementById('calendar-grid');
  const monthTitle = document.getElementById('calendar-title-month');
  const yearTitle = document.getElementById('calendar-title-year');
  const reportDateHeader = document.getElementById('report-date-header');

  const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

  function generateCalendar() {
    const now = new Date(); // In real app, this would be based on selected state
    const year = now.getFullYear();
    const month = now.getMonth();
    const today = now.getDate();

    // Set Header
    monthTitle.textContent = months[month];
    yearTitle.textContent = year;

    // Set Report Date to Today
    reportDateHeader.textContent = `${months[month].substring(0, 3)} ${today}, ${year}`;

    // Logic to generate the "5-Day Work Week" Month view

    const firstDayOfMonth = new Date(year, month, 1);

    let startDay = firstDayOfMonth.getDay(); // 0-6

    // Logic: Calculate how many days back to the previous Monday.
    let daysToBacktrack = startDay === 0 ? 6 : startDay - 1;

    // Start date for the grid
    let currentDate = new Date(year, month, 1 - daysToBacktrack);

    // We will render 6 weeks to cover the month
    const weeksToRender = 6;
    const totalWorkDays = weeksToRender * 5; // 5 days per week

    let htmlContent = '';
    let cellsRendered = 0;
    let iterations = 0;

    while (cellsRendered < totalWorkDays && iterations < 100) {
      const dayOfWeek = currentDate.getDay(); // 0=Sun, 6=Sat

      // Only render if it's a weekday (1-5)
      if (dayOfWeek >= 1 && dayOfWeek <= 5) {
        const isToday = currentDate.getDate() === today && currentDate.getMonth() === month && currentDate.getFullYear() === year;
        const dateNum = currentDate.getDate();
        const isCurrentMonth = currentDate.getMonth() === month;
        const cellYear = currentDate.getFullYear();
        const cellMonth = currentDate.getMonth();

        // Style classes
        const textClass = isCurrentMonth ? 'text-gray-900' : 'text-gray-400';
        const fontClass = isToday ? 'font-bold' : 'font-medium';
        const cellClass = isToday ? 'today-highlight' : 'bg-white';

        // Find tasks for this specific date
        const tasksForDay = appData.tasks.filter(t => {
          return t.date.getDate() === dateNum &&
                  t.date.getMonth() === cellMonth &&
                  t.date.getFullYear() === cellYear;
        });

        let taskHtml = '';
        // Limit to 3 tasks visually to prevent overflow
        tasksForDay.slice(0, 3).forEach((task, index) => {
          const mt = index === 0 ? 'mt-auto' : 'mt-1'; // Push first task to bottom if space
          // Just use mt-1 for simplicity in stacking
          taskHtml += `<div class="text-[10px] px-2 py-1 rounded font-medium ${task.color} mt-1 truncate" title="${task.title}">${task.title}</div>`;
        });

        if (tasksForDay.length > 3) {
          taskHtml += `<div class="text-[9px] text-gray-400 mt-1 pl-1">+${tasksForDay.length - 3} more</div>`
        }

        // Push content to bottom if few tasks, or just list them
        // To keep "date" at top and "tasks" filling from bottom is tricky with flex-col
        // We use justify-between.
        // If we want tasks at bottom, we need a container that grows or margin-top: auto on the first task wrapper.

        htmlContent += `
                        <div class="calendar-cell ${cellClass} group cursor-pointer relative">
                            <span class="${textClass} ${fontClass} text-sm mb-1 group-hover:text-blue-600">${dateNum}</span>
                            <div class="w-full mt-auto">
                                ${taskHtml}
                            </div>
                        </div>
                    `;

        cellsRendered++;
      }

      // Move to next day
      currentDate.setDate(currentDate.getDate() + 1);
      iterations++;
    }

    calendarGrid.innerHTML = htmlContent;
  }

  // Run on load
  generateCalendar();
  renderTaskList(); // Render initial list
</script>
</body>
</html>